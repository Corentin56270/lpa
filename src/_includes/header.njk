<header>
  <style>
    /* Utility: pas de retour à la ligne */
    .no-wrap { white-space: nowrap; }

    /* Desktop (>=1031px): seulement les menus sur une seule ligne */
    @media (min-width: 1031px) {
      header .header-nav-list { flex-wrap: nowrap; }
      header .nav-item-parent { flex-wrap: nowrap; }
      /* Rapprocher le bloc textes du logo, de façon responsive et sans chevauchement */
      header .header-top {
        justify-content: flex-start;
        gap: clamp(8px, 2vw, 24px);
      }
      header .header-texts {
        flex: 1 1 auto;
        min-width: 0;
      }
    }

    /* Entre 1031px et 1225px: menu en pleine largeur sous le logo */
    @media (min-width: 1031px) and (max-width: 1225px) {
      header .header-top {
        display: grid;
        grid-template-columns: auto 1fr;
        grid-template-areas:
          "header-logo header-texts"
          "header-nav header-nav";
        align-items: center;
      }
      header .header-logo { grid-area: header-logo; }
      header .header-texts { grid-area: header-texts; }
      header #header-nav.header-nav {
        grid-area: header-nav;
        width: 100%;
        position: static; /* s’assurer que le menu n’est pas absolu dans cette tranche */
      }
    }
  </style>
    <div class="header-top">
      <a href="/index.html" class="header-logo">
        <img src="/media/logo.png" alt="Logo" class="logo">
      </a>
      <button class="header-menu-toggle" type="button" aria-expanded="false" aria-controls="header-nav">
        <span class="sr-only">Menu</span>
        <span class="header-menu-icon" aria-hidden="true"></span>
      </button>
      <div class="header-texts">
        <a href="index.html" class="header-title-link">
          <h1 class="no-wrap">Lomener Port d'Attache</h1>
        </a>
        <p class="header-subtitle no-wrap">Association</p>
      </div>
      <nav id="header-nav" class="header-nav">
        <ul class="header-nav-list">
          <!-- Qui sommes nous -->
          <li class="nav-item nav-item--has-children">
            <div class="nav-item-parent">
              <a class="nav-link" href="/presentation/index.html" aria-haspopup="true">Qui sommes nous</a>
              <button class="nav-submenu-toggle" type="button" aria-haspopup="true" aria-expanded="false" aria-controls="nav-submenu-qui">
                <span class="sr-only">Afficher les sections de Qui sommes nous</span>
                <span class="nav-submenu-icon" aria-hidden="true"></span>
              </button>
            </div>
            <ul id="nav-submenu-qui" class="nav-submenu" aria-label="Sections Qui sommes nous">
              <li><a href="/presentation/index.html#valeurs">Nos valeurs</a></li>
              <li><a href="/presentation/index.html#historique">Historique</a></li>
              <li><a href="/presentation/index.html#membres">Le conseil d'administration</a></li>
              <li><a href="/presentation/index.html#statuts">Les statuts</a></li>
              <li><a href="/presentation/index.html#territoire">Territoire</a></li>
            </ul>
          </li>

          <!-- Nous contacter -->
          <li class="nav-item"><a class="nav-link" href="/contact/index.html">Nous contacter</a></li>

          <!-- Nos actualités -->
          <li class="nav-item nav-item--has-children">
            <div class="nav-item-parent">
              <a class="nav-link no-wrap" href="/index.html" aria-haspopup="true">Nos actualités</a>
              <button class="nav-submenu-toggle" type="button" aria-haspopup="true" aria-expanded="false" aria-controls="nav-submenu-actus">
                <span class="sr-only">Afficher les sections d'Actualités</span>
                <span class="nav-submenu-icon" aria-hidden="true"></span>
              </button>
            </div>
            <ul id="nav-submenu-actus" class="nav-submenu" aria-label="Sections d'Actualités">
              <li><a href="/index.html">Actualités</a></li>
              <li><a href="/documentation/index.html#presse">Vu dans la presse</a></li>
            </ul>
          </li>

          <!-- Nous rejoindre -->
          <li class="nav-item nav-item--has-children">
            <div class="nav-item-parent">
              <a class="nav-link" href="/inscription/index.html" aria-haspopup="true">Nous rejoindre</a>
              <button class="nav-submenu-toggle" type="button" aria-haspopup="true" aria-expanded="false" aria-controls="nav-submenu-rejoindre">
                <span class="sr-only">Afficher les options pour nous rejoindre</span>
                <span class="nav-submenu-icon" aria-hidden="true"></span>
              </button>
            </div>
            <ul id="nav-submenu-rejoindre" class="nav-submenu" aria-label="Options pour nous rejoindre">
              <li><a href="https://www.helloasso.com/associations/lomener-port-d-attache" target="_blank" rel="noopener">Hello asso</a></li>
              <li><a href="/media/inscription.pdf" target="_blank" rel="noopener noreferrer">PDF</a></li>
            </ul>
          </li>

          <!-- Documentation -->
          <li class="nav-item nav-item--has-children">
            <div class="nav-item-parent">
              <a class="nav-link no-wrap" href="/documentation/index.html" aria-haspopup="true">Documentation</a>
              <button class="nav-submenu-toggle" type="button" aria-haspopup="true" aria-expanded="false" aria-controls="nav-submenu-documentation">
                <span class="sr-only">Afficher les sections de Documentation</span>
                <span class="nav-submenu-icon" aria-hidden="true"></span>
              </button>
            </div>
            <ul id="nav-submenu-documentation" class="nav-submenu" aria-label="Sections de Documentation">
              <li><a href="/documentation/index.html#parutions">Grain de sel</a></li>
              <li><a href="/documentation/index.html#parutions">Nos parutions</a></li>
            </ul>
          </li>
        </ul>
      </nav>
    </div>
</header>
<script>
  (() => {
    const toggle = document.querySelector('.header-menu-toggle');
    const nav = document.getElementById('header-nav');
    if (!toggle || !nav) {
      return;
    }

    const submenuToggles = Array.from(nav.querySelectorAll('.nav-submenu-toggle'));

    const closeAllSubmenus = () => {
      submenuToggles.forEach((btn) => {
        btn.setAttribute('aria-expanded', 'false');
        const parentItem = btn.closest('.nav-item--has-children');
        if (parentItem) {
          parentItem.classList.remove('is-open');
        }
      });
    };

    const closeOnOutsideClick = (event) => {
      if (!nav.classList.contains('is-open')) {
        return;
      }
      const target = event.target;
      if (!nav.contains(target) && target !== toggle && !toggle.contains(target)) {
        toggle.setAttribute('aria-expanded', 'false');
        nav.classList.remove('is-open');
        closeAllSubmenus();
      }
    };

    toggle.addEventListener('click', () => {
      const isExpanded = toggle.getAttribute('aria-expanded') === 'true';
      toggle.setAttribute('aria-expanded', String(!isExpanded));
      nav.classList.toggle('is-open', !isExpanded);
      if (isExpanded) {
        closeAllSubmenus();
      }
    });

    submenuToggles.forEach((btn) => {
      btn.addEventListener('click', (event) => {
        event.preventDefault();
        event.stopPropagation();
        const parentItem = btn.closest('.nav-item--has-children');
        const isExpanded = btn.getAttribute('aria-expanded') === 'true';
        if (!isExpanded) {
          submenuToggles.forEach((otherBtn) => {
            if (otherBtn !== btn) {
              otherBtn.setAttribute('aria-expanded', 'false');
              const otherItem = otherBtn.closest('.nav-item--has-children');
              if (otherItem) {
                otherItem.classList.remove('is-open');
              }
            }
          });
        }
        btn.setAttribute('aria-expanded', String(!isExpanded));
        if (parentItem) {
          parentItem.classList.toggle('is-open', !isExpanded);
        }
      });
    });

    const desktopMedia = window.matchMedia('(min-width: 1031px)');
    const handleDesktopChange = (event) => {
      if (event.matches) {
        closeAllSubmenus();
      }
    };
    if (typeof desktopMedia.addEventListener === 'function') {
      desktopMedia.addEventListener('change', handleDesktopChange);
    } else {
      desktopMedia.addListener(handleDesktopChange);
    }

    nav.addEventListener('keydown', (event) => {
      if (event.key === 'Escape' && nav.classList.contains('is-open')) {
        toggle.setAttribute('aria-expanded', 'false');
        nav.classList.remove('is-open');
        closeAllSubmenus();
        toggle.focus();
      }
    });

    document.addEventListener('click', closeOnOutsideClick);
  })();
</script>
